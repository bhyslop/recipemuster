= Bash Utilities Specification
:doctype: book

// tag::mapping-section[]
//
// Category declarations:
// bust_:  Tabtarget (launcher naming vesture)
// busd:   Dispatch (non-terminal, tabtarget system umbrella)
// busdc_: Dispatch Colophon (routing identifier)
// busdf_: Dispatch Frontispiece (human-readable description)
// busdi_: Dispatch Imprint (embedded parameter/target specifier)
// busdm_: Dispatch Formulary (routing component)
// busdl_: Dispatch Launcher (bootstrap script)
// bukro_: Kit Regime Operation (kindle/validate/render)
// burc_:  Configuration Regime (project-level settings)
// burs_:  Station Regime (developer-level settings)
//
// Variant patterns:
//   _s: plural form
//   _p: possessive form
//

// Tabtarget Vesture
:bust_tabtarget:        <<bust_tabtarget,Tabtarget Vesture>>

// Dispatch
:busdc_colophon:        <<busdc_colophon,Colophon>>
:busdc_colophon_s:      <<busdc_colophon,Colophons>>
:busdf_frontispiece:    <<busdf_frontispiece,Frontispiece>>
:busdf_frontispiece_s:  <<busdf_frontispiece,Frontispieces>>
:busdi_imprint:         <<busdi_imprint,Imprint>>
:busdi_imprint_s:       <<busdi_imprint,Imprints>>
:busdm_formulary:       <<busdm_formulary,Formulary>>
:busdm_formulary_s:     <<busdm_formulary,Formularies>>
:busdl_launcher:        <<busdl_launcher,Launcher>>
:busdl_launcher_s:      <<busdl_launcher,Launchers>>

// Axial Regime Terms (from AXLA — matching RBSA)
:axrg_assignment:                  <<axrg_assignment,Assignment>>
:axrg_assignment_s:                <<axrg_assignment,Assignments>>
:axrg_prefix:                      <<axrg_prefix,Regime Prefix>>
:axrg_regime:                      <<axrg_regime,Regime>>
:axrg_regime_s:                    <<axrg_regime,Regimes>>
:axrg_variable:                    <<axrg_variable,Regime Variable>>
:axrg_variable_s:                  <<axrg_variable,Regime Variables>>

// Axial Format Terms (from AXLA — matching RBSA)
:axf_bash:                         <<axf_bash,Bash Format>>

// BUK Regime Operation Terms
:bukro_kindle:                     <<bukro_kindle,BUK Kindle>>
:bukro_validate:                   <<bukro_validate,BUK Validate>>
:bukro_render:                     <<bukro_render,BUK Render>>

// BUK Regime Prefixes
:burc_prefix:                      <<burc_prefix,BURC_>>
:burs_prefix:                      <<burs_prefix,BURS_>>

// BURC Regime: Configuration (project-level BUK settings)
:burc_regime:                      <<burc_regime,BURC Regime>>
:burc_station_file:                <<burc_station_file,BURC_STATION_FILE>>
:burc_tabtarget_dir:               <<burc_tabtarget_dir,BURC_TABTARGET_DIR>>
:burc_tabtarget_delimiter:         <<burc_tabtarget_delimiter,BURC_TABTARGET_DELIMITER>>
:burc_tools_dir:                   <<burc_tools_dir,BURC_TOOLS_DIR>>
:burc_project_root:                <<burc_project_root,BURC_PROJECT_ROOT>>
:burc_managed_kits:                <<burc_managed_kits,BURC_MANAGED_KITS>>
:burc_temp_root_dir:               <<burc_temp_root_dir,BURC_TEMP_ROOT_DIR>>
:burc_output_root_dir:             <<burc_output_root_dir,BURC_OUTPUT_ROOT_DIR>>
:burc_log_last:                    <<burc_log_last,BURC_LOG_LAST>>
:burc_log_ext:                     <<burc_log_ext,BURC_LOG_EXT>>

// BURS Regime: Station (developer-level BUK settings)
:burs_regime:                      <<burs_regime,BURS Regime>>
:burs_log_dir:                     <<burs_log_dir,BURS_LOG_DIR>>

// end::mapping-section[]

== Overview

The Bash Utilities Specification defines the tabtarget dispatch system — the infrastructure for tab-completion-friendly launchers that route to kit formularies.

BUK invented tabtargets; BUK defines them.

For universal naming vocabulary (Cipher, Signet, Epithet, Inscription, Vesture), see VLS-VoxLiturgicalSpec.adoc.

== Tabtarget Vesture

[[bust_tabtarget]]
// ⟦axl_voices axo_entity⟧
{bust_tabtarget}::
Vesture for tabtarget launcher identifiers.
Defines how launcher scripts in `tt/` are named.
+
* signet_case: lowercase with hyphen (the colophon)
* separator: `.`
* epithet_case: PascalCase (the frontispiece)
* envelope: `.sh`
+
Pattern: `{colophon}.{frontispiece}[.{imprint}].sh`
+
Examples:
+
* `rbw-B.ConnectBottle.sh` — RBW workbench, ConnectBottle operation
* `rbw-B.ConnectBottle.nsproto.sh` — same, with imprint specifying target
* `jjw-.HeatMount.sh` — JJK workbench, HeatMount operation
* `buw-tt.LauncherList.sh` — BUK tabtarget testbench, LauncherList operation

== Dispatch

The dispatch vocabulary defines the tabtarget launcher system.
A
{busdl_launcher}
validates arguments and delegates to a
{busdm_formulary}.
The
{busdc_colophon}
identifies the routing path;
the
{busdf_frontispiece}
provides human-readable description;
the
{busdi_imprint}
embeds target parameters.

[[busdc_colophon]]
// ⟦axl_voices axt_string⟧
{busdc_colophon}::
The routing identifier in a tabtarget inscription.
A
{busdc_colophon}
determines which
{busdm_formulary}
handles the dispatch.
Includes the hyphen as part of its identity (e.g., `rbw-`, `buw-tt-`).
+
The
{busdc_colophon}
is the first component of the tabtarget pattern, before the first dot separator.
+
Examples:
+
* `rbw-` routes to RBW workbench
* `jjw-` routes to JJK workbench
* `buw-tt-` routes to BUK tabtarget testbench

[[busdf_frontispiece]]
// ⟦axl_voices axt_string⟧
{busdf_frontispiece}::
The human-readable description in a tabtarget inscription.
A
{busdf_frontispiece}
uses PascalCase and describes the operation.
+
Appears after the
{busdc_colophon}
and dot separator.
+
Examples: `Build`, `ConnectBottle`, `RunVVX`, `HeatMount`.

[[busdi_imprint]]
// ⟦axl_voices axt_string⟧
{busdi_imprint}::
An optional embedded parameter in a tabtarget inscription.
An
{busdi_imprint}
specifies a target, instance, or configuration variant.
+
Appears after a second dot separator following the
{busdf_frontispiece}.
+
Examples:
+
* `nsproto` in `rbw-B.ConnectBottle.nsproto.sh`
* `srjcl` in `rbw-B.ConnectBottle.srjcl.sh`

[[busdm_formulary]]
// ⟦axl_voices axo_entity⟧
{busdm_formulary}::
A component that routes
{busdc_colophon_s}
to implementations.
Each
{busdm_formulary}
registers handlers for a set of
{busdc_colophon_s}
and dispatches to the appropriate function.
+
Types:
+
* **Workbench** (`{prefix}w_workbench.sh`): Routes commands for a kit
* **Testbench** (`{prefix}t_testbench.sh`): Routes tests for a kit
+
A
{busdm_formulary}
is sourced by the
{busdl_launcher}
and provides the dispatch function.

[[busdl_launcher]]
// ⟦axl_voices axo_entity⟧
{busdl_launcher}::
A bootstrap script in the `tt/` directory that validates arguments and delegates to a
{busdm_formulary}.
A
{busdl_launcher}
is the entry point for tabtarget invocation.
+
Naming follows
{bust_tabtarget}:
`{colophon}.{frontispiece}[.{imprint}].sh`
+
Responsibilities:
+
* Parse
{busdc_colophon}
from own filename
* Validate required arguments
* Source the target
{busdm_formulary}
* Invoke the dispatched function

== Routing Behavior

=== Dispatch Flow

. User invokes launcher: `./tt/rbw-B.ConnectBottle.nsproto.sh`
. Launcher parses its filename to extract:
* {busdc_colophon}:
`rbw-B`
* {busdf_frontispiece}:
`ConnectBottle`
* {busdi_imprint}:
`nsproto`
. Launcher sources the appropriate
{busdm_formulary}
(`rbw_workbench.sh`)
. Formulary's dispatch function routes based on frontispiece
. Target function executes with imprint as parameter

=== Workbench Pattern

[source,bash]
----
# Tools/{kit}/{prefix}w_workbench.sh

{prefix}w_dispatch() {
    local frontispiece="$1"
    local imprint="$2"
    shift 2

    case "$frontispiece" in
        Build)          {prefix}w_build "$imprint" "$@" ;;
        ConnectBottle)  {prefix}w_connect_bottle "$imprint" "$@" ;;
        *)              buc_fatal "Unknown frontispiece: $frontispiece" ;;
    esac
}
----

=== Testbench Pattern

Testbenches follow the same pattern but route to test functions:

[source,bash]
----
# Tools/{kit}/{prefix}t_testbench.sh

{prefix}t_dispatch() {
    local frontispiece="$1"
    shift

    case "$frontispiece" in
        Unit)        {prefix}t_unit "$@" ;;
        Integration) {prefix}t_integration "$@" ;;
        *)           buc_fatal "Unknown test: $frontispiece" ;;
    esac
}
----

=== Colophon Conventions

{busdc_colophon_s}
follow a structure that encodes both kit identity and formulary type:

* `{cipher}-` — default workbench (e.g., `rbw-`, `jjw-`)
* `{cipher}-t-` — testbench (e.g., `buw-t-`, `jjw-t-`)
* `{cipher}-{variant}-` — specialized workbench (e.g., `rbw-B-` for bottle operations)

The trailing hyphen is always part of the colophon — it separates the routing prefix from the dot-delimited tabtarget components.

== Regime Configuration

BUK defines two
{axrg_regime_s}
for project and developer configuration.
{axrg_assignment_s}
use
{axf_bash}
format (shell variable assignment files that are sourced).

=== Regime Prefixes

[[burc_prefix]]
// ⟦axl_voices axrg_prefix⟧
{burc_prefix}::
Bash Utility Configuration Regime

[[burs_prefix]]
// ⟦axl_voices axrg_prefix⟧
{burs_prefix}::
Bash Utility Station Regime

=== Kit Regime Operations

[[bukro_kindle]]
// ⟦axvr_kindle⟧
{bukro_kindle}::
Silent initialization of Bash Utility Kit regime state from
{axrg_assignment_s}.
Sets defaults, detects unexpected variables, builds derived structures.

[[bukro_validate]]
// ⟦axvr_validate⟧
{bukro_validate}::
Strict field validation for Bash Utility Kit
{axrg_regime_s}.
Checks all type and constraint requirements via buv_env_* validators.

[[bukro_render]]
// ⟦axvr_render⟧
{bukro_render}::
Diagnostic display of Bash Utility Kit
{axrg_regime}
state.

=== BURC Regime

[[burc_regime]]
// ⟦axvr_regime axf_bash axrd_file_sourced axrd_singleton⟧
{burc_regime}::
Configuration regime for project-level BUK settings.
BURC assignment files in `.buk/burc.env` define repository structure and tabtarget infrastructure.

[[burc_station_file]]
// ⟦axvr_variable axd_required axtu_path⟧
{burc_station_file}::
Path to the developer's personal
{burs_regime}
assignment file.

[[burc_tabtarget_dir]]
// ⟦axvr_variable axd_required axtu_path⟧
{burc_tabtarget_dir}::
Directory containing
{busdl_launcher}
scripts.

[[burc_tabtarget_delimiter]]
// ⟦axvr_variable axd_required axtu_string⟧
{burc_tabtarget_delimiter}::
Single-character token separator in
{bust_tabtarget}
inscriptions.

[[burc_tools_dir]]
// ⟦axvr_variable axd_required axtu_path⟧
{burc_tools_dir}::
Directory containing BUK utilities and project tool scripts.

[[burc_project_root]]
// ⟦axvr_variable axd_required axtu_path⟧
{burc_project_root}::
Path from assignment file location to the project root directory.

[[burc_managed_kits]]
// ⟦axvr_variable axd_required axtu_string⟧
{burc_managed_kits}::
Comma-separated list of kits managed by vvx.
At release time, determines which kits are built into the binary.
At install time, must exactly match the parcel's kit list.

[[burc_temp_root_dir]]
// ⟦axvr_variable axd_required axtu_path⟧
{burc_temp_root_dir}::
Root directory for BUK temporary files.

[[burc_output_root_dir]]
// ⟦axvr_variable axd_required axtu_path⟧
{burc_output_root_dir}::
Root directory for BUK command output files.

[[burc_log_last]]
// ⟦axvr_variable axd_required axtu_xname⟧
{burc_log_last}::
Filename stem for the most recent command execution log.

[[burc_log_ext]]
// ⟦axvr_variable axd_required axtu_xname⟧
{burc_log_ext}::
File extension for log files, without leading dot.

=== BURS Regime

[[burs_regime]]
// ⟦axvr_regime axf_bash axrd_file_sourced axrd_singleton⟧
{burs_regime}::
Configuration regime for developer-level BUK settings.
BURS assignment files are personal to each developer and not committed to version control.

[[burs_log_dir]]
// ⟦axvr_variable axd_required axtu_path⟧
{burs_log_dir}::
Directory where this developer stores BUK operation logs.
