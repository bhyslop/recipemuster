
Add a new
{jjdkr_tack}
to a
{jjdpr_pace}.
This is the unified operation for all
{jjdkr_tack}
creation: state transitions, plan refinements, or both.

{jjds_arguments}

// ⟦axd_optional axd_defaulted⟧
* {jjda_file}

// ⟦axd_required⟧
* {jjdt_coronet}
(positional)

// ⟦axd_optional⟧
* {jjda_state}
— if absent, inherits from previous
{jjdkr_tack}

// ⟦axd_conditional⟧
* {jjda_direction}
— required if
{jjda_state}
is
{jjdpe_bridled};
forbidden if
{jjda_state}
is provided and not
{jjdpe_bridled};
ignored if
{jjda_state}
is absent (inherits with state)

// ⟦axd_optional⟧
* {jjda_silks}
— if provided, new Tack uses this value; otherwise inherits from previous Tack

// ⟦axd_optional⟧
* stdin —
{jjdkm_text}
content; if absent, inherits from previous
{jjdkr_tack}

{jjds_stdout} None

{jjds_exit_uniform} 0 success, non-zero error.

{jjds_behavior}

.
{jjdr_load}
{jjda_file};
on failure, exit immediately with
{jjdr_load}
error status
. Extract parent
{jjdt_firemark}
from
{jjdt_coronet}
(first 2 base64 chars after prefix)
. Verify
{jjdhr_heat}
exists
. Verify
{jjdpr_pace}
exists with given
{jjdt_coronet}
. Read current
{jjdkr_tack}
from `tacks[0]`
. Determine new state:
.. If
{jjda_state}
provided: use that value
.. Otherwise, if previous state is
{jjdpe_bridled}
AND stdin provided new text: force state to
{jjdpe_rough}
(new spec invalidates old direction)
.. Otherwise: inherit from previous
{jjdkr_tack}
. Determine new direction:
.. If
{jjda_state}
is
{jjdpe_bridled}:
use
{jjda_direction}
argument (required)
.. If previous state was
{jjdpe_bridled}
AND state was auto-reset to
{jjdpe_rough}
(new spec provided without explicit state): omit
{jjdkm_direction}
(spec change invalidates direction)
.. If
{jjda_state}
is absent and previous state is
{jjdpe_bridled}:
inherit from previous
{jjdkr_tack}
.. Otherwise: omit
{jjdkm_direction}
. Determine new text:
.. If stdin provided: use stdin content
.. Otherwise: inherit from previous
{jjdkr_tack}
. Create new
{jjdkr_tack}
with:
.. {jjdkm_refined}:
current timestamp (YYMMDD-HHMM)
.. {jjdkm_state}:
determined above
.. {jjdkm_text}:
determined above
.. {jjdkm_silks}:
inherited from previous `tacks[0].silks`
.. {jjdkm_commit}:
capture {jjdkm_commit}
.. {jjdkm_direction}:
determined above (if applicable)
. Prepend new
{jjdkr_tack}
to `tacks` array (position 0)
.
{jjdr_save}
{jjdgr_gallops}
to
{jjda_file}
