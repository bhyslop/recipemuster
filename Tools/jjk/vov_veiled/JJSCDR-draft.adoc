
Move a
{jjdpr_pace}
from one
{jjdhr_heat}
to another.
This is a primitive operation: mechanical transfer with no ceremony.
The
{jjdpr_pace}
receives a new
{jjdt_coronet}
in the destination
{jjdhr_heat};
all
{jjdkr_tack}
history is preserved.

*Important:* "Relocated" is not a
{jjdpr_pace}
state.
{jjdpr_pace}
states remain:
{jjdpe_rough},
{jjdpe_bridled},
{jjdpe_complete},
{jjdpe_abandoned}.
Relocate is an operation that moves
{jjdpr_pace_s}
between
{jjdhr_heat_s};
state is preserved through the move.

{jjds_arguments}

// ⟦axd_optional axd_defaulted⟧
* {jjda_file}

// ⟦axd_required⟧
* {jjdt_coronet}
(positional) —
{jjdpr_pace}
to move

// ⟦axd_required⟧
* {jjda_to}
— destination
{jjdt_firemark}

// ⟦axd_optional⟧
* {jjda_before}
— insert before specified
{jjdt_coronet}
in destination

// ⟦axd_optional⟧
* {jjda_after}
— insert after specified
{jjdt_coronet}
in destination

// ⟦axd_optional⟧
* {jjda_first}
— insert at beginning of destination
{jjdhm_order}

*Positioning:* Only one of
{jjda_before},
{jjda_after},
or
{jjda_first}
may be specified.
If none provided, append to end of destination
{jjdhm_order}
(default).

{jjds_stdout} New
{jjdt_coronet}
in destination
{jjdhr_heat}

{jjds_exit_uniform} 0 success, non-zero error.

{jjds_behavior}

.
{jjdr_load}
{jjda_file};
on failure, exit immediately with
{jjdr_load}
error status
. Extract source
{jjdt_firemark}
from
{jjdt_coronet}
(first 2 base64 chars after prefix)
. Verify source
{jjdhr_heat}
exists
. Verify
{jjdpr_pace}
exists in source
{jjdhr_heat}
. Verify destination
{jjdhr_heat}
exists with given
{jjdt_firemark}
. If
{jjda_before}
or
{jjda_after}
provided, verify target
{jjdt_coronet}
exists in destination
{jjdhr_heat}
. Read destination
{jjdhm_seed}
. Construct new
{jjdt_coronet}:
`₢` + destination
{jjdt_firemark}
(2 chars) + destination
{jjdhm_seed}
(3 chars)
. Copy
{jjdpr_pace}
data to destination with new
{jjdt_coronet}:
.. Prepend new
{jjdkr_tack}
recording the relocate:
... {jjdkm_refined}:
current timestamp (YYMMDD-HHMM)
... {jjdkm_state}:
inherited from previous `tacks[0].state`
... {jjdkm_text}:
`Relocated from {old_coronet} in {source_firemark}.\n\n` + previous `tacks[0].text`
... {jjdkm_silks}:
inherited from previous `tacks[0].silks`
... {jjdkm_commit}:
capture {jjdkm_commit}
.. Preserve remaining
{jjdkr_tack}
history
. Insert new
{jjdt_coronet}
into destination
{jjdhm_order}
at determined position
. Increment destination
{jjdhm_seed}
. Remove
{jjdpr_pace}
from source
{jjdhr_heat}:
.. Remove from source `paces` object
.. Remove from source
{jjdhm_order}
.
{jjdr_save}
{jjdgr_gallops}
to
{jjda_file}
. Output new
{jjdt_coronet}
to stdout

*Validation errors:*

[cols="2,3"]
|===
| Condition | Error

| Source and destination same
| "Cannot relocate pace to same heat"

| Source {jjdpr_pace} not found
| "Pace {coronet} not found in heat {firemark}"

| Destination {jjdhr_heat} not found
| "Heat {firemark} not found"

| Target {jjdt_coronet} not found in destination
| "Target pace {coronet} not found in heat {firemark}"
|===
