NOTE: This sequence within
{opss_sentry_start}
establishes required networks for the
{at_bottle_service}.

// ⟦axs_behavior⟧
. *Remove Existing
{at_transit_network}*:
.. {rbbc_call}
podman network remove for
{at_transit_network_name},
ignoring errors
.. NOTE: This ensures a clean state before creating the new transit network

. *Create New
{at_transit_network}*:
.. {rbbc_call}
podman network create with:
... name:
{at_transit_network_name}
... type: bridge
... IPv6: disabled
... external connectivity: enabled
.. Apply configuration consistent with
{rbrn_moniker}-uplink
definition
.. {rbbc_require}
transit network created successfully

. *Remove Existing
{at_enclave_network}*:
.. {rbbc_call}
podman network remove for
{at_enclave_network_name},
ignoring errors
.. NOTE: This ensures a clean state before creating the new enclave network

. *Create New
{at_enclave_network}*:
.. {rbbc_call}
podman network create with:
... name:
{at_enclave_network_name}
... type: isolated bridge
... subnet:
{rbrn_enclave_base_ip}/{rbrn_enclave_netmask}
... external connectivity: disabled
... IP assignment: managed by netavark
.. {rbbc_require}
enclave network created successfully

After this sequence completes, both networks exist in standard Podman configuration. The
{at_sentry_container}
will connect to both networks, while the
{at_bottle_container}
will connect only to the
{at_enclave_network}.
Before the
{at_bottle_container}
starts, an
{at_ebpf_program}
will be attached to its veth interface to ensure all traffic routes through the
{at_sentry_container}.
