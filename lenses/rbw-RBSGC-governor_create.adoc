The
{rbtr_payor}
creates a
{rbtr_governor}
{giam_service_account}
within the
{rbtgi_depot_project}:

. *Step 1: Depot Project Validation*:
.. {rbbc_require}
{rbrr_depot_project_id}
exists (via projects.get API call)
.. {rbbc_require}
{rbrr_depot_project_id}
!=
{rbrp_payor_project_id}

. Create the
{rbtr_governor}
{giam_service_account}:
.. {rbbc_call}
link:https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts/create[iam.serviceAccounts.create]
to create service account in
{rbrr_depot_project_id}
.. Set `accountId` to `«INPUT_ACCOUNT_ID»` following RB naming conventions
.. Use display name: `
{rbtr_governor}
role for project administration`
.. {rbbc_store}
`«GOVERNOR_SERVICE_ACCOUNT»` from response `.email` field
.. {rbbc_require}
service account creation successful (HTTP 200)
. Verify
{giam_service_account}
creation and propagation:
.. {rbbc_call}
link:https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts/get[iam.serviceAccounts.get]
to query service account using
`«GOVERNOR_SERVICE_ACCOUNT»`
.. {rbbc_poll}
with 3-5 second intervals for up to 30 seconds if service account not immediately available
.. {rbbc_require}
service account accessible before proceeding
. Preflight: Ensure pristine key state:
.. {rbbc_call}
link:https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts.keys/list[serviceAccounts.keys.list]
to list existing keys for
`«GOVERNOR_SERVICE_ACCOUNT»`
.. {rbbc_store}
`«EXISTING_KEYS»` from response `.keys[]`
.. {rbbc_require}
no keys with `keyType: USER_MANAGED` exist (pristine-state requirement)
.. {rbbc_fatal}
if conflicts found - manual cleanup required
. Grant
{gcp_project_id}
-level
permissions:
.. {rbbc_call}
link:https://cloud.google.com/resource-manager/reference/rest/v3/projects/setIamPolicy[projects.setIamPolicy]
to update IAM policy on
{rbrr_depot_project_id}
.. {rbbc_use}
`«GOVERNOR_SERVICE_ACCOUNT»` as principal
.. Add role: `roles/owner` (excluding billing permissions maintained by
{rbtr_payor})
.. Set policy version: 3 for conditional binding support
.. {rbbc_require}
IAM policy update successful
. Generate
{rbrr_governor_rbra_file}:
.. {rbbc_call}
link:https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts.keys/create[serviceAccounts.keys.create]
to create service account key for
`«GOVERNOR_SERVICE_ACCOUNT»`
.. Set keyAlgorithm: `KEY_ALG_RSA_2048`, privateKeyType: `TYPE_GOOGLE_CREDENTIALS_FILE`
.. {{rbbc_store}
`«GOVERNOR_PRIVATE_KEY_DATA»` from response `.privateKeyData` field
.. {rbtoe_rbra_generate}
converts
`«GOVERNOR_PRIVATE_KEY_DATA»`
to
`{rbrr_governor_rbra_file}`
.. NOTE: Script outputs copy command for RBRA file installation
.. {rbbc_warn}
if
{rbrr_governor_rbra_file}
already exists
.. {rbbc_require}
RBRA file creation successful
